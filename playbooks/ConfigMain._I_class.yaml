---
- name: Config Build Part - I Class
  hosts: target_hosts
  gather_facts: false

  vars_files:
    - vars.yml

  tasks:

    ########################################################################
    # â”€â”€â”€â”€â”€â”€â”€â”€ FIRST RUN â”€â”€â”€â”€â”€â”€â”€â”€
    ########################################################################

    - name: PowerUp (Run 1)
      include_tasks: PowerUp.yaml
      tags: [powerup]

    - name: Pause after PowerUp (Run 1)
      pause:
        seconds: "{{ pause_powerup_seconds }}"
      tags: [pause, powerup]

    - name: Enable LLDP (Run 1)
      include_tasks: Enable_LLDP.yaml
      tags: [lldp]

    - name: Pause after LLDP (Run 1)
      pause:
        seconds: "{{ pause_lldp_seconds }}"
      tags: [lldp]

    - name: RackSlot (Run 1)
      include_tasks: RackSlot.yaml
      tags: [rackslot]

    - name: Asset Tag (Run 1)
      include_tasks: asset_tag.yaml
      tags: [assettag]

    - name: Pause for provision tasks (Run 1)
      pause:
        seconds: "{{ pause_provision_seconds }}"
      tags: [assettag]

    - name: Firmware (Run 1)
      include_tasks: Firmware.yaml
      tags: [update]

    - name: Pause after firmware update (Run 1)
      pause:
        seconds: "{{ pause_firmware_seconds }}"
      tags: [update]

    - name: Power Cycle (Run 1)
      include_tasks: powercycle.yaml
      tags: [reboot]

    - name: Pause after Power Cycle (Run 1)
      pause:
        seconds: "{{ pause_reboot_seconds }}"
      tags: [reboot]

    - name: Import XML (Run 1)
      include_tasks: ImportXML.yaml
      tags: [xml]

    - name: Pause after XML import (Run 1)
      pause:
        seconds: "{{ pause_configure_seconds }}"
      tags: [xml]

    - name: Power Cycle (Run 1 - Final)
      include_tasks: powercycle.yaml
      tags: [reboot]

    - name: Pause after final Power Cycle (Run 1)
      pause:
        seconds: "{{ pause_powercycle_seconds }}"
      tags: [reboot]


    ########################################################################
    # â”€â”€â”€â”€â”€â”€â”€â”€ SECOND RUN â”€â”€â”€â”€â”€â”€â”€â”€
    ########################################################################

    - name: Enable LLDP (Run 2)
      include_tasks: Enable_LLDP.yaml
      tags: [lldp]

    - name: Pause after LLDP (Run 2)
      pause:
        seconds: "{{ pause_lldp_seconds }}"
      tags: [lldp]

    - name: RackSlot (Run 2)
      include_tasks: RackSlot.yaml
      tags: [rackslot]

    - name: Asset Tag (Run 2)
      include_tasks: asset_tag.yaml
      tags: [assettag]

    - name: Pause for provision tasks (Run 2)
      pause:
        seconds: "{{ pause_provision_seconds }}"
      tags: [assettag]

    - name: Firmware (Run 2)
      include_tasks: Firmware.yaml
      tags: [update]

    - name: Pause after firmware update (Run 2)
      pause:
        seconds: "{{ pause_firmware_seconds }}"
      tags: [update]

    - name: Power Cycle (Run 2)
      include_tasks: powercycle.yaml
      tags: [reboot]

    - name: Pause after Power Cycle (Run 2)
      pause:
        seconds: "{{ pause_reboot_seconds }}"
      tags: [reboot]

    - name: Import XML (Run 2)
      include_tasks: ImportXML.yaml
      tags: [xml]

    - name: Pause after XML import (Run 2)
      pause:
        seconds: "{{ pause_configure_seconds }}"
      tags: [xml]

    - name: Power Cycle (Run 2 - Final)
      include_tasks: powercycle.yaml
      tags: [reboot]

    - name: Pause after final Power Cycle (Run 2)
      pause:
        seconds: "{{ pause_powercycle_seconds }}"
      tags: [reboot]


    ########################################################################
    # â”€â”€â”€â”€â”€â”€â”€â”€ FINAL SUMMARY â”€â”€â”€â”€â”€â”€â”€â”€
    ########################################################################

    - name: Debug Output
      debug:
        msg:
          - "âœ… Run 1 completed sequence:"
          - "    PowerUp â†’ LLDP â†’ RackSlot â†’ AssetTag â†’ Firmware â†’ PowerCycle â†’ ImportXML â†’ PowerCycle (Final)"
          - ""
          - "âœ… Run 2 completed sequence:"
          - "    LLDP â†’ RackSlot â†’ AssetTag â†’ Firmware â†’ PowerCycle â†’ ImportXML â†’ PowerCycle (Final)"
          - ""
          - "ðŸŽ¯ All configuration build steps for {{ inventory_hostname }} (I Class) completed successfully after both runs."
      tags: [summary]
